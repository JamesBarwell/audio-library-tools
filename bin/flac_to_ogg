#!/bin/bash

set -e

SAVEIFS=$IFS
IFS=$(echo -en "\n\b")

dir=$(readlink -f $1)
output=$(readlink -f $2)

if [ ! -d "$dir" ] || [ ! -d "$output" ]; then
    echo "Directory not found"
    exit 1
fi

output_path="$output/${dir##*/}"
echo 'Creating directory at' $output_path
mkdir -p "$output_path"

flacs=$(find $dir -type f -name "*.flac" | sort --numeric-sort)

for flac_path in $flacs
do
    flac_name=${flac_path##*/}
    ogg_name="${flac_name%flac}ogg"
    output_ogg_path="$output_path/$ogg_name"

    echo "Converting $flac_path to $output_ogg_path"
    sox --show-progress $flac_path $output_ogg_path
done

IFS=$SAVEIFS

exit 0
